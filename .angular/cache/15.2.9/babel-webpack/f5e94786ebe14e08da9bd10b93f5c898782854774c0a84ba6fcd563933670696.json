{"ast":null,"code":"var _class;\nimport { Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./balance.service\";\nimport * as i2 from \"src/modules/profile/services/user.service\";\n/**\n * @description:\n */\nexport class CapsuleTime {\n  constructor() {\n    /**\n     * @description:\n     */\n    this.list_timelaps = [];\n  }\n  /**\n   * @description:\n   * @returns\n   */\n  moment_to_play() {\n    return this.list_timelaps.includes('moment_to_play');\n  }\n  /**\n   * @description:\n   */\n  victory_message() {\n    return this.list_timelaps.includes('victory');\n  }\n  /**\n   * @description:\n   */\n  generate_tickets() {\n    return this.list_timelaps.includes('generate_tickets');\n  }\n  /**\n   * @description:\n   */\n  random_draw() {\n    return this.list_timelaps.includes('random_draw');\n  }\n  /**\n   * @description:\n   */\n  wait_before_next_party() {\n    return this.list_timelaps.includes('wait_before_next_party');\n  }\n  /**\n   * @description:\n   */\n  timelaps_is_empty() {\n    return this.list_timelaps.length === 0;\n  }\n  /**\n   * @description:\n   */\n  timelaps_is_not_empty() {\n    return !this.timelaps_is_empty();\n  }\n}\n;\n;\n;\n;\nexport class PlayroomService {\n  // @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ [LOGIC]\n  constructor(balanceService, userService) {\n    this.balanceService = balanceService;\n    this.userService = userService;\n    /**\n     * @description: The stream of data from the websocket\n     */\n    this.stream = new Subject();\n    /**\n     * @description:\n     */\n    this.stream_winning_number = new Subject();\n    /**\n     * @description: Envoyer une messages pour indiquer que c'est la fin de partie.\n     */\n    this.endpartystream = new Subject();\n    /**\n     * @description:\n     */\n    this.caps = new CapsuleTime();\n    // @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ [PARAMS]\n    /**\n     * @description:\n     * @param.time -> the time in the game in second\n     * @param.utc_timestamp the utc timestamp of the game server.\n     * @param.recept_time the time when the client receive the message.\n     */\n    this.init_party = {\n      time: 0,\n      utc_timestamp: 0\n    };\n    /**\n     * @description:\n     */\n    this.party = {\n      time: 0\n    };\n    /**\n     * @description:\n     */\n    this.timestrategy = [];\n    // TODO: Il faut creer un process de reset puissant pour chaque party\n    setTimeout(() => {\n      this.update_time();\n    }, 1000);\n  }\n  /**\n   * @description: update the time in the game.\n   */\n  update_time() {\n    // alert ('aoeoauoea')\n    if (this.init_party.recept_time === undefined) {\n      setTimeout(() => {\n        this.update_time();\n      }, 200);\n      return;\n    }\n    // -> La difference entre le temps actuel et le temps de reception de l'initialisation.\n    let diff_begin_now = new Date().getTime() / 1000 - this.init_party.recept_time.getTime() / 1000;\n    // -> La taille d'une partie en seconde.\n    let party_duration = this.get_party_duration();\n    // -> La difference entre le temps actuel et le temps de reception de l'initialisation.\n    let party = diff_begin_now % party_duration;\n    this.party.time = this.init_party.time + party;\n    this.party.time = this.party.time % party_duration;\n    this.caps = this.getTimeLaps(this.party.time);\n    this.stream.next({\n      event: 'party_time',\n      data: {\n        time: this.party.time,\n        caps: this.caps\n      }\n    });\n    // TODO: Il y aurait un bug a ce niveaux.\n    try {\n      setTimeout(() => {\n        this.update_time();\n      }, 200);\n    } catch (error) {}\n  }\n  /**\n   * @description: Get the duration maximum for the party, based in the timestrategy\n   */\n  get_party_duration() {\n    let max_duration_encountred = 0;\n    for (let i = 0; i < this.timestrategy.length; i++) {\n      const element = this.timestrategy[i];\n      if (element.time_end > max_duration_encountred) {\n        max_duration_encountred = element.time_end;\n      }\n    }\n    return max_duration_encountred;\n  }\n  /**\n   * @description:\n   * @param data\n   */\n  get_timelaps(timelas) {\n    return timelas.time_end - timelas.time_start;\n  }\n  /**\n   * @description:\n   */\n  getTimeLaps(time) {\n    let timelaps;\n    let timelaps_list = [];\n    for (let i = 0; i < this.timestrategy.length; i++) {\n      const element = this.timestrategy[i];\n      if (time >= element.time_start && time <= element.time_end) {\n        timelaps_list.push(element.key);\n      }\n    }\n    let capsule = new CapsuleTime();\n    capsule.list_timelaps = timelaps_list;\n    return capsule;\n  }\n  // @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ [RECEPTOR]\n  /**\n   * @description:\n   */\n  recept__lottery_ticket_values(data) {\n    this.stream.next({\n      event: 'lottery_ticket_values',\n      data: data\n    });\n  }\n  /**\n   * @description:\n   */\n  recept__timestrategy(data) {\n    this.timestrategy = data;\n  }\n  /**\n   * @description:\n   */\n  recept__initparty(data) {\n    Object.assign(this.init_party, data);\n    this.init_party.recept_time = new Date();\n    this.get_party_duration();\n  }\n  /**\n   * @description:\n   */\n  recept__account_balance(data) {\n    this.balanceService.setBalance(data);\n    this.recept__ticket_list(data);\n    // this.stream.next({\n    //   event: 'account_balance',\n    //   data: data,\n    // });\n  }\n  /**\n   * @description:\n   */\n  recept__party_value(data) {}\n  /**\n   * @description:\n   */\n  recept__playing(data) {}\n  /**\n   * @description:\n   */\n  recept__ticket_list(data) {\n    if (typeof data === 'number') {\n      return;\n    }\n    this.stream.next({\n      event: 'ticket_list',\n      data: data\n    });\n  }\n  /**\n   * @description:\n   */\n  recept__error(data) {}\n  /**\n   * @description:\n   */\n  recept__winner_list(data) {}\n  /**\n   * @description:\n   */\n  recept__jackpot(data) {\n    this.stream.next({\n      event: 'jackpot',\n      data: data\n    });\n  }\n  /**\n   * @description:\n   */\n  recept__winning_number(data) {\n    this.printrun_winning_number = data;\n    this.printrun_run();\n  }\n  /**\n   * @description:\n   */\n  recept__new_party(data) {\n    window.location.reload();\n  }\n  /**\n   * @description:\n   */\n  send_selected_ticket(ticket) {\n    this.ws_connection?.wsService.send(this.ws_connection, {\n      play: ticket.value\n    });\n  }\n  /**\n   * @description:\n   */\n  printrun_run() {\n    setTimeout(() => {\n      if (this.printrun_winning_number === undefined) {\n        return;\n      }\n      ;\n      if (!this.caps.random_draw()) {\n        this.printrun_run();\n        return;\n      }\n      for (let bobine of this.printrun_winning_number) {\n        if (bobine.sended) {\n          continue;\n        }\n        if (bobine.whentotime <= this.party.time) {\n          bobine.sended = true;\n          this.stream_winning_number.next(bobine);\n        }\n      }\n      this.printrun_run();\n    }, 500);\n  }\n  /**\n   * @description:\n   */\n  endpartynext(event) {\n    if (!this.userService.is_authenticated()) {\n      this.endpartynext('reset');\n      return;\n    }\n    this.endpartystream.next(event);\n  }\n}\n_class = PlayroomService;\n_class.ɵfac = function PlayroomService_Factory(t) {\n  return new (t || _class)(i0.ɵɵinject(i1.BalanceService), i0.ɵɵinject(i2.UserService));\n};\n_class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: _class,\n  factory: _class.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["Subject","CapsuleTime","constructor","moment_to_play","list_timelaps","includes","victory_message","generate_tickets","random_draw","wait_before_next_party","timelaps_is_empty","length","timelaps_is_not_empty","PlayroomService","balanceService","userService","time","utc_timestamp","setTimeout","update_time","init_party","recept_time","undefined","diff_begin_now","Date","getTime","party_duration","get_party_duration","party","caps","getTimeLaps","stream","next","event","data","error","max_duration_encountred","i","timestrategy","element","time_end","get_timelaps","timelas","time_start","timelaps","timelaps_list","push","key","capsule","recept__lottery_ticket_values","recept__timestrategy","recept__initparty","Object","assign","recept__account_balance","setBalance","recept__ticket_list","recept__party_value","recept__playing","recept__error","recept__winner_list","recept__jackpot","recept__winning_number","printrun_winning_number","printrun_run","recept__new_party","window","location","reload","send_selected_ticket","ticket","ws_connection","wsService","send","play","value","bobine","sended","whentotime","stream_winning_number","endpartynext","is_authenticated","endpartystream","factory","providedIn"],"sourceRoot":"","sources":["/var/projects/gtender/client2/src/app/services/playroom.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { WebSocketsConfig } from './websocket.service';\nimport { BalanceService } from './balance.service';\nimport { UserService } from 'src/modules/profile/services/user.service';\n\n/**\n * @description:\n{\n                        bobine: 3,     // -> the bobine of the ticket\n                        number: 1,     // -> the number of the ticket\n                        whentotime: 7, // -> the time to show in the party\n                    } \n */\nexport interface PrintRunWinningNumber {\n  bobine: number,\n  number: number,\n  whentotime: number,\n  sended?: boolean,\n}\n\n/**\n * @description:\n */\nexport class CapsuleTime {\n  /**\n   * @description:\n   */\n  list_timelaps: Array<string> = [];\n\n  /**\n   * @description: \n   * @returns \n   */\n  public moment_to_play() {\n    return this.list_timelaps.includes('moment_to_play');\n  }\n\n  /**\n   * @description: \n   */\n  public victory_message() {\n    return this.list_timelaps.includes('victory');\n  }\n\n  /**\n   * @description:\n   */\n  public generate_tickets() {\n    return this.list_timelaps.includes('generate_tickets');\n  }\n\n  /**\n   * @description:\n   */\n  public random_draw() {\n    return this.list_timelaps.includes('random_draw');\n  }\n\n  /**\n   * @description:\n   */\n  public wait_before_next_party() {\n    return this.list_timelaps.includes('wait_before_next_party');\n  }\n\n  /**\n   * @description:\n   */\n  public timelaps_is_empty() {\n    return this.list_timelaps.length === 0;\n  }\n\n  /**\n   * @description:\n   */\n  public timelaps_is_not_empty() {\n    return !this.timelaps_is_empty();\n  }\n}\n\n/**\n * @description: \n */\ninterface TimeStrategyTimeLaps {\n  key: string, \n  name: string, \n  time_start: number,\n  time_end: number,\n};\n\n/**\n * @description: \n */\ninterface TimeParty {\n  time: number,\n  utc_timestamp: number,\n  recept_time?: Date,\n};\n\n/**\n * @description: \n */\ninterface TimeStrategy {\n  key: string,\n  name: string,\n  time_end: number,\n  time_start: number,\n};\n\n/**\n * @description: \n */\nexport interface PlayroomStream {\n  event: string,\n  data: any,\n};\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PlayroomService {\n  /**\n   * @description: \n   */\n  public ws_connection: WebSocketsConfig | undefined;\n\n  /**\n   * @description: The stream of data from the websocket \n   */\n  public stream: Subject<PlayroomStream> = new Subject<PlayroomStream>();\n\n  /**\n   * @description: \n   */\n  public stream_winning_number: Subject<any> = new Subject<any>();\n\n  /**\n   * @description: \n   */\n  private printrun_winning_number: Array<PrintRunWinningNumber> | undefined;\n\n  /**\n   * @description: Envoyer une messages pour indiquer que c'est la fin de partie.\n   */\n  public endpartystream: Subject<any> = new Subject<any>();\n\n  /**\n   * @description:\n   */\n  public caps: CapsuleTime = new CapsuleTime();\n\n  // @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ [PARAMS]\n  /**\n   * @description: \n   * @param.time -> the time in the game in second\n   * @param.utc_timestamp the utc timestamp of the game server.\n   * @param.recept_time the time when the client receive the message.\n   */\n  public init_party: TimeParty = {\n    time: 0, \n    utc_timestamp: 0,\n  };\n\n  /**\n   * @description: \n   */\n  public party = {\n    time: 0,\n  };\n\n  /**\n   * @description: \n   */\n  public timestrategy: Array<TimeStrategy> = [];\n\n  // @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ [LOGIC]\n\n  constructor(\n    private balanceService: BalanceService,\n    private userService: UserService, \n  ) {\n    // TODO: Il faut creer un process de reset puissant pour chaque party\n    setTimeout(() => {\n      this.update_time();\n    }, 1000);\n  }\n\n  /** \n   * @description: update the time in the game. \n   */\n  public update_time() {\n    // alert ('aoeoauoea')\n    if (this.init_party.recept_time === undefined) {\n      setTimeout(() => {\n        this.update_time();\n      }, 200);\n      return;\n    }\n\n    // -> La difference entre le temps actuel et le temps de reception de l'initialisation.\n    let diff_begin_now: number = (new Date().getTime() / 1000) - this.init_party.recept_time.getTime() / 1000;\n    \n    // -> La taille d'une partie en seconde.\n    let party_duration: number = this.get_party_duration();\n    \n    // -> La difference entre le temps actuel et le temps de reception de l'initialisation.\n    let party = diff_begin_now % party_duration;\n\n    this.party.time = this.init_party.time + party;\n    this.party.time = this.party.time % party_duration;\n\n    this.caps = this.getTimeLaps(this.party.time);\n    this.stream.next({\n      event: 'party_time',\n      data: {\n        time: this.party.time,\n        caps: this.caps,\n      },\n    });\n\n    // TODO: Il y aurait un bug a ce niveaux.\n    try {\n      setTimeout(() => {\n        this.update_time();\n      }, 200);\n    } catch (error) { }\n  }\n\n  /**\n   * @description: Get the duration maximum for the party, based in the timestrategy\n   */\n  public get_party_duration() { \n    let max_duration_encountred = 0;\n    for (let i = 0; i < this.timestrategy.length; i++) {\n      const element = this.timestrategy[i];\n      if (element.time_end > max_duration_encountred) {\n        max_duration_encountred = element.time_end;\n      }\n    }\n    return max_duration_encountred;\n  }\n\n  /**\n   * @description: \n   * @param data \n   */\n  public get_timelaps(timelas: TimeStrategyTimeLaps) {\n    return timelas.time_end - timelas.time_start;\n  }\n\n  /**\n   * @description: \n   */\n  public getTimeLaps(time: number) {\n    let timelaps: TimeStrategyTimeLaps | undefined;\n    let timelaps_list: Array<string> = [];\n    for (let i = 0; i < this.timestrategy.length; i++) {\n      const element = this.timestrategy[i];\n      if (time >= element.time_start && time <= element.time_end) {\n        timelaps_list.push(element.key);\n      }\n    }\n\n    let capsule = new CapsuleTime();\n    capsule.list_timelaps = timelaps_list;\n    return capsule;\n  }\n\n  // @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ [RECEPTOR]\n  /**\n   * @description: \n   */\n  public recept__lottery_ticket_values(data: any): void {\n    this.stream.next({\n      event: 'lottery_ticket_values',\n      data: data,\n    });\n  }\n\n  /**\n   * @description: \n   */\n  public recept__timestrategy(data: Array<TimeStrategy>): void {\n    this.timestrategy = data;\n  }\n\n  /**\n   * @description: \n   */\n  public recept__initparty(data: any): void {\n    Object.assign(this.init_party, data);\n    this.init_party.recept_time = new Date();\n    this.get_party_duration();\n  }\n\n  /**\n   * @description: \n   */\n  public recept__account_balance(data: any) {\n    this.balanceService.setBalance(data);\n    this.recept__ticket_list(data);\n    // this.stream.next({\n    //   event: 'account_balance',\n    //   data: data,\n    // });\n  }\n\n  /**\n   * @description:\n   */\n  public recept__party_value(data: any) { }\n\n  /**\n   * @description:\n   */\n  public recept__playing(data: any) { }\n\n  /**\n   * @description:\n   */\n  public recept__ticket_list(data: any) {\n    if (typeof data === 'number') {\n      return;\n    }\n\n    this.stream.next({\n      event: 'ticket_list',\n      data: data,\n    });\n  }\n\n  /**\n   * @description: \n   */\n  public recept__error(data: any) { }\n\n  /**\n   * @description: \n   */\n  public recept__winner_list(data: any) {\n\n  }\n\n  /**\n   * @description: \n   */\n  public recept__jackpot(data: any) {\n    this.stream.next({\n      event: 'jackpot',\n      data: data,\n    });\n  }\n\n  /**\n   * @description: \n   */\n  public recept__winning_number(data: any) {\n    this.printrun_winning_number = data;\n    this.printrun_run();\n  }\n\n  /**\n   * @description:\n   */\n  public recept__new_party(data: any): void {\n    window.location.reload();\n  }\n\n  /**\n   * @description:\n   */\n  public send_selected_ticket(ticket: any): void {\n    this.ws_connection?.wsService.send(\n      this.ws_connection,\n      {\n        play: ticket.value,\n    });\n  }\n\n  /**\n   * @description:\n   */\n  public printrun_run(): void {\n    setTimeout(() => {\n      if (this.printrun_winning_number === undefined) {\n        return; \n      };\n\n      if (!this.caps.random_draw()) {\n        this.printrun_run(); \n        return;\n      }\n\n      for (let bobine of this.printrun_winning_number) {\n        if (bobine.sended) { continue; }\n\n        if (bobine.whentotime <= this.party.time) {\n          bobine.sended = true;\n          this.stream_winning_number.next(bobine);\n        }\n      }\n      this.printrun_run();\n    }, 500);\n  }\n\n  /**\n   * @description:\n   */\n  public endpartynext(event: 'gameover' | 'win' | 'reset'): void {\n    if (!this.userService.is_authenticated()) {\n      this.endpartynext('reset');\n      return;\n    }\n    this.endpartystream.next(event);\n  }\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}